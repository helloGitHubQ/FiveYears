# 其他

## 大表优化

当 MYSQL 单表记录超过一定数量之后，数据库的 CRUD 性能会明显下降。然后就有了几个优化措施。

### 限定数据范围

比如说你不要去查询所有的历史数据，而去查询一年的或者一个月的历史数据。当数据量变小之后，性能就会明显变好很多。

*务必禁止不带任何限制数据范围条件的查询语句。*

### 读写分离

这样做就是为了减轻数据的压力。*可以主库进行写，从库进行读。*这是经典的数据库拆分方案。

### 垂直分区

*根据数据库里面数据表的相关性进行拆分。*是三大范式设计中的一种。:smile:

简单来说垂直拆分是指数据表列的拆分，把一张列比较多的表拆分多张表。

- 优点：可以使得列数据变小，在查询时减少读取的 Block 数，减少 I/O 次数。此外可以简化表的结构，易于维护。
- 缺点：主键出现冗余，需要管理冗余列，并会引起 join 操作，可以通过在应用层进行 join 来解决。此外，垂直分区会让事务变得更加复杂。

### 水平分区

*保存数据表结构不变，通过某种策略存储数据分片。这样每一片数据分散到不同的表或库中，达到了分布式的目的。水平拆分可以支撑非常大的数据量。*

水平拆分是指数据表行的拆分，表行数超过 200 万行时，就会变慢，这时可以把一张的表的数据拆分多张表来存放。

水平拆分最好分库！！！

水平拆分能够支持非常大的数据量存储，应用端改造也少，但是 **分片事务难以解决，跨节点 Join 性能比较差，逻辑复杂。**尽量不要对数据进行分片，因为拆分会带来逻辑，部署，运维的各种复杂度，一般数据表在优化得当的情况下可以支撑千万以下的数据量是没有太大问题的。如果实在要分片，尽量选择客户端分片架构，这样可以减少一次和中间件的网络 I/O

数据库水平分区的两种常见方案：

- 客户端代理

  分片逻辑在应用端，封装在 jar 包中，通过修改或者封装 JDBC 层来实现。

  当当网的 Sharding-JDBC，阿里的TDDL

- 中间件代理

  在应用和数据中间加了一个代理层。分片逻辑同一维护在中间件服务中。

  Mycat，360的Atlas，网易的DDB等

[MySQL大表优化方案](https://segmentfault.com/a/1190000006158186)

## 池化设计思想

为什么会有池这个概念呢？之前也知道了很多比如说线程池，常量池等。我们也知道池给我带来的好处。

数据库中池是什么池呢？她就是连接池。

因为你正常步骤需要加载数据库驱动，连接数据库，进行数据操作，断开连接。

数据库连接本质就是一个 **socket** 连接，数据库服务端还要维护一些缓存中和用户权限信息之类的，所以占用了一些内存。在连接池中，创建连接之后，将其放置在池中，并再次使用它，因为不必建立新的连接。如果使用了所有连接，则会建立一个新连接并将其添加到池中。

[池化设计思想](https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247485679&idx=1&sn=57dbca8c9ad49e1f3968ecff04a4f735&chksm=cea24724f9d5ce3212292fac291234a760c99c0960b5430d714269efe33554730b5f71208582&token=1141994790&lang=zh_CN%23rd)



[一次 SQL 查询优化原理分析（900W+ 数据，从 17s 到 300ms）](https://mp.weixin.qq.com/s/RlfYVgo0M4tCM9ZXReA9lA)

